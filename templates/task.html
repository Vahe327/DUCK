<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Task List</title>
<link rel="preload" href="/static/footer.css" as="style" onload="this.rel='stylesheet'">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background: url('/static/img/fon.jpg') no-repeat center center fixed;
            background-size: cover;
            font-family: 'Arial', sans-serif;
            color: #ffffff;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            border-radius: 20px;
            padding: 20px;
            width: 90%;
            height: 50%;
            padding-bottom: 120px; /* –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–π –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
            max-width: 500px;
            background: rgba(0, 0, 0, 0.8);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            background: url('static/img/fon.jpg') no-repeat center center;
            background-size: cover;
            color: #ffffff;
            margin-top: 0px;
            position: relative;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 10px;
        }

        .balance-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .balance-container img {
            width: 40px;
            height: 50px;
            margin-right: 10px;
        }

        .balance-text {
            font-size: 1.0em;
            color: #FFD700;
            font-weight: bold;
        }

        .task-list {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
            max-height: 400px;
            overflow-y: auto;
            color: #ffffff;
        }

        .task-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            border: 2px solid #FFD700;
            background-color: rgba(105, 105, 105, 0.8);
            margin-bottom: 10px;
            border-radius: 10px;
            font-size: 1em;
        }

        .task-item img {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }

        .task-item .task-text {
            flex-grow: 1;
            font-size: 1.1em;
        }

        .task-item .reward {
            font-weight: bold;
            margin-left: 15px;
            font-size: 1.1em;
            color: #FFD700;
        }

        .task-item button {
            padding: 8px 15px;
            background-color: #32CD32;
            border: 2px solid #228B22;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            color: #ffffff;
            font-size: 1em;
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }

        .task-item button:hover {
            background-color: #28a745;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="balance-container">
                <img src="/static/img/16.png" alt="Coin Logo">
                <div class="balance-text" id="balance-coin">–ë–∞–ª–∞–Ω—Å</div>
            </div>
            <div class="balance-container">
                <img src="/static/img/usdt.png" alt="USDT Logo">
                <div class="balance-text" id="balance-usdt">–ë–∞–ª–∞–Ω—Å</div>
            </div>
        </div>

        <div class="task-list" id="task-list">
            <!-- Tasks will be dynamically inserted here -->
        </div>

        <div class="footer">
            <button class="custom-button" onclick="window.location.href='/friends.html?user_id={{ user_id }}'">
                <img src="static/img/friends.png" alt="–î—Ä—É–∑—å—è">
                <span class="label">–î—Ä—É–∑—å—è</span>
            </button>
            <button class="custom-button" onclick="window.location.href='/mining.html?user_id={{ user_id }}'">
                <img src="static/img/mining.png" alt="–ú–∞–π–Ω–∏–Ω–≥">
                <span class="label">–ú–∞–π–Ω–∏–Ω–≥</span>
            </button>
            <button class="custom-button" onclick="window.location.href='/index.html?user_id={{ user_id }}'">
                <img src="static/img/game.png" alt="–ò–≥—Ä–∞">
                <span class="label">–ò–≥—Ä–∞</span>
            </button>
            <button class="custom-button" onclick="window.location.href='/task.html?user_id={{ user_id }}'">
                <img src="static/img/task.png" alt="–ó–∞–¥–∞—á–∏">
                <span class="label">–ó–∞–¥–∞—á–∏</span>
            </button>
             <button class="custom-button" onclick="window.location.href='/airdrop.html?user_id={{ user_id }}'">
            <img src="static/img/6.png" alt="Airdrop">
            <span class="label">USDT –ú–∞–π–Ω–∏–Ω–≥</span>
        </button>
        </div>
    </div>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        const userId = '{{ user_id }}'; // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

        // –ó–∞–¥–∞—á–∏
        const tasks = [
            {
                id: 'TG',
                text: '–ù–∞—à –∫–∞–Ω–∞–ª TG',
                reward: '+100,000 DCT',
                action: null,
                link: null,
                icon: '/static/img/tg.png' // –ø—É—Ç—å –∫ –∏–∫–æ–Ω–∫–µ
            },
            {
                id: 'TWITTER',
                text: '–ù–∞—à –∫–∞–Ω–∞–ª Twitter',
                reward: '+100,000 DCT',
                action: null,
                link: null,
                icon: '/static/img/twit.png' // –ø—É—Ç—å –∫ –∏–∫–æ–Ω–∫–µ
            },
            {
                id: 'CHAT',
                text: '–ù–∞—à —á–∞—Ç TG',
                reward: '+100,000 DCT',
                action: null,
                link: null,
                icon: '/static/img/youtube.png' // –ø—É—Ç—å –∫ –∏–∫–æ–Ω–∫–µ
            },
            {
                id: 'REFERRAL',
                text: '–ü—Ä–∏–≥–ª–∞—Å–∏ 3 –¥—Ä—É–∑–µ–π',
                reward: '+50,000 DCT',
                action: null,
                link: null,
                icon: '/static/img/refer.png' // –ø—É—Ç—å –∫ –∏–∫–æ–Ω–∫–µ
            },
            {
                id: 'PARTNER',
                text: '–ù–∞—à –ø–∞—Ä—Ç–Ω–µ—Ä',
                reward: '+100,000 DCT',
                action: null,
                link: null,
                icon: '/static/img/tg.png' // –ø—É—Ç—å –∫ –∏–∫–æ–Ω–∫–µ
            },
            {
                id: 'FIRST_DEPOSIT',
                text: '–í—ã–ø–æ–ª–Ω–∏ –ø–µ—Ä–≤—ã–π –¥–µ–ø–æ–∑–∏—Ç',
                reward: 'üîë 1 –∫–ª—é—á',
                action: null,
                link: null, // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
                icon: '/static/img/kl.png' // –ø—É—Ç—å –∫ –∏–∫–æ–Ω–∫–µ
            },
            {
                id: 'SECOND_DEPOSIT',
                text: '–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –¥–µ–ø–æ–∑–∏—Ç',
                reward: 'üîë 1 –∫–ª—é—á',
                action: null,
                link: null, // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
                icon: '/static/img/kl.png' // –ø—É—Ç—å –∫ –∏–∫–æ–Ω–∫–µ
            }
        ];

        // –§—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∑–∞–¥–∞—á
        function renderTasks(taskStates) {
            const taskList = document.getElementById('task-list');

            tasks.forEach((task, index) => {
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item';

                if (task.icon) {
                    const icon = document.createElement('img');
                    icon.src = task.icon;
                    icon.alt = `Icon ${index + 1}`;
                    taskItem.appendChild(icon);
                }

                const taskText = document.createElement('div');
                taskText.className = 'task-text';
                taskText.textContent = task.text;
                taskItem.appendChild(taskText);

                const reward = document.createElement('div');
                reward.className = 'reward';
                reward.textContent = task.reward;
                taskItem.appendChild(reward);

                const button = document.createElement('button');
                if (taskStates[task.id] && taskStates[task.id].completed) {
                    button.disabled = true;
                    button.textContent = '–í—ã–ø–æ–ª–Ω–µ–Ω–æ';
                    button.classList.add('disabled');
                } else if (!task.link) {
                    button.disabled = true;
                    button.textContent = '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ';
                    button.classList.add('disabled');
                } else {
                    button.textContent = '–í—ã–ø–æ–ª–Ω–∏—Ç—å';
                    button.onclick = () => {
                        if (task.action) task.action();
                        if (task.link) window.location.href = task.link;
                        button.disabled = true;
                        button.textContent = '–í—ã–ø–æ–ª–Ω–µ–Ω–æ';
                        button.classList.add('disabled');
                        updateTaskState(task.id);
                    };
                }

                taskItem.appendChild(button);
                taskList.appendChild(taskItem);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ DCT
        function addToBalance(amount) {
            fetch('/add-balance', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    user_id: userId,
                    amount: amount
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(`–ù–∞ –≤–∞—à –±–∞–ª–∞–Ω—Å –¥–æ–±–∞–≤–ª–µ–Ω–æ ${amount} DCT`);
                    fetchBalanceDCT(); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ DCT –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
                } else {
                    alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞: ' + data.message);
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞:', error);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–¥–∞—á–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        function updateTaskState(taskId) {
            fetch('/update-task-state', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    user_id: userId,
                    task_id: taskId,
                    completed: true
                })
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–¥–∞—á–∏:', error);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–¥–∞—á —Å —Å–µ—Ä–≤–µ—Ä–∞
        function fetchTaskStates() {
            return fetch(`/task-states?user_id=${encodeURIComponent(userId)}`)
                .then(response => response.json())
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–¥–∞—á:', error);
                    return {};
                });
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ DCT
        function fetchBalanceDCT() {
            fetch(`/balance/dct?user_id=${encodeURIComponent(userId)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.balance !== undefined) {
                        document.getElementById('balance-coin').textContent = ` ${data.balance} DCT`;
                    } else {
                        console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ DCT: ', data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è DCT:', error);
                });
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ USDT
        function fetchBalanceUSDT() {
            fetch(`/balance/usdt?user_id=${encodeURIComponent(userId)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.balance !== undefined) {
                        document.getElementById('balance-usdt').textContent = ` ${data.balance} USDT`;
                    } else {
                        console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ USDT: ', data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è USDT:', error);
                });
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–≤
        function updateBalances() {
            fetchBalanceDCT();
            fetchBalanceUSDT();
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∑–∞–¥–∞—á –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            fetchTaskStates().then(taskStates => {
                renderTasks(taskStates);
                updateBalances();
            });
        };
    </script>
</body>
</html>

